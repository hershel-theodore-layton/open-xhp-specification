/** open-xhp-specification is MIT licensed, see /LICENSE. */
namespace HTL\OpenXHPSpecification;

use type Facebook\HackTest\HackTest;
use function Facebook\FBExpect\expect;

final class
  GivenASpreadOfSpecialSetAttributeToATagWithTheSameAttributeSpecifiedInTheXHPOpenTest
  extends HackTest {
  const type SpreadTarget = tag\empty;
  const type Source = tag\empty;

  protected static function targetBefore(
    this::Source $src,
  ): this::SpreadTarget {
    return <tag:empty data-special="from-before-spread" {...$src} />;
  }

  protected static function targetAfter(this::Source $src): this::SpreadTarget {
    return <tag:empty {...$src} data-special="from-after-spread" />;
  }

  protected static function source(): this::Source {
    return <tag:empty data-special="from-spread" />;
  }

  public async function test_the_common_values_set_before_the_spread_are_overridden(
  ): Awaitable<void> {
    $type_under_test = static::targetBefore(static::source());
    expect(get_attributes($type_under_test))->toEqual(
      tuple(dict[], dict['data-special' => 'from-spread']),
    );
  }

  public async function test_the_common_values_set_after_the_spread_override_the_spread(
  ): Awaitable<void> {
    $type_under_test = static::targetAfter(static::source());
    expect(get_attributes($type_under_test))->toEqual(
      tuple(dict[], dict['data-special' => 'from-after-spread']),
    );
  }
}
